# 任务总结

## 已修复的错误

### ✅ 1. subplot0_controller 未定义错误
- **位置**: `src/ui/windows/nmf_window.py`
- **修复**: 添加了异常处理，确保在获取控制器失败时使用全局配置

## 待实现的功能

### 1. 谱线扫描增强
- [ ] 扫描图例（不仅仅是谱线）
- [ ] 支持单独修改图例
- [ ] 支持单独更换谱线颜色，图例跟着变颜色（包括阴影）

### 2. 组间平均对比图修复
- [ ] 修复谱线扫描失效问题（只会显示一条）
- [ ] 修复峰值检测问题（好像没用）

## 实现计划

### 步骤1: 增强谱线扫描功能
1. 修改 `SpectrumScanPanel` 以支持扫描图例
2. 添加颜色选择控件
3. 添加图例修改控件
4. 确保颜色变化同步到图例和阴影

### 步骤2: 修复组间平均对比图
1. 检查 `run_group_average_waterfall` 中的谱线扫描逻辑
2. 检查峰值检测逻辑
3. 确保样式配置正确应用

## 注意事项

- 需要确保颜色变化同步到图例和阴影
- 需要确保谱线扫描能正确扫描所有谱线
- 需要确保峰值检测在组间平均对比图中正常工作

